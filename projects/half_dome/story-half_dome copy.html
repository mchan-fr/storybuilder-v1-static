<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hiking Half Dome</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⛰️</text></svg>">
  <meta property="og:title" content="Hiking Half Dome">
  <meta property="og:description" content="A multimedia story by Marcus Chan">
  <meta property="og:type" content="article">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="author" content="Marcus Chan">
  <meta name="reading-time" content="2 min read">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
*{box-sizing:border-box}
html,body{
  min-height:100%;
  height:auto;
  margin:0;
  overflow-x:hidden;
  overflow-y:auto;
  background:#000;
  overscroll-behavior:auto;
}
img,video{display:block;max-width:100%;height:auto}

.text-shadow{text-shadow:0 2px 8px rgba(0,0,0,.55)}
.reveal-line{opacity:0;transform:translateY(6px);transition:.35s ease}
.reveal-line.visible{opacity:1;transform:translateY(0)}
.fullbleed{width:100vw!important;max-width:100vw!important;margin-left:calc(50% - 50vw)!important;margin-right:calc(50% - 50vw)!important}
.breakout-large{width:56rem;max-width:calc(100vw - 2rem);position:relative;left:50%;transform:translateX(-50%)}

/* ========================================
   MUTE BUTTON - SHARED STYLES
   ======================================== */
.mute-btn{
  position:absolute;
  bottom:20px;
  left:20px;
  width:44px;
  height:44px;
  background:rgba(0,0,0,0.7);
  border:none;
  border-radius:50%;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:100;
  transition:background 0.2s ease;
}
.mute-btn:hover{background:rgba(0,0,0,0.9)}
.mute-btn:active{transform:scale(0.95)}

/* Desktop: show desktop mute btn, hide mobile */
.desktop-mute-btn{display:flex}
.mobile-mute-btn{display:none}

/* ========================================
   HERO BLOCK
   ======================================== */
.sb-hero{position:relative}
.sb-hero .hero-image-section{position:relative;height:100vh;min-height:480px}
.sb-hero .media{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block}
.sb-hero .hero-gradient{display:none}
.sb-hero .overlay{position:absolute;inset:0;display:flex;flex-direction:column;z-index:10;padding:1rem}
.sb-hero .overlay.items-start{justify-content:flex-start}
.sb-hero .overlay.items-end{justify-content:flex-end}
.sb-hero .overlay.items-center{justify-content:center}
.sb-hero .overlay.justify-start{align-items:flex-start}
.sb-hero .overlay.justify-end{align-items:flex-end}
.sb-hero .overlay.justify-center{align-items:center}
.pt-20{padding-top:5rem}.pb-20{padding-bottom:5rem}.pl-20{padding-left:5rem}.pr-20{padding-right:5rem}

/* Hero Desktop: show desktop overlay, hide mobile elements */
.sb-hero .desktop-overlay{display:flex}
.sb-hero .mobile-overlay{display:none}
.hero-mobile-deck-section{display:none}

/* Hero Mobile Media Support */
.sb-hero .media-picture{position:absolute;inset:0;width:100%;height:100%}
.sb-hero .media-picture img{width:100%;height:100%;object-fit:cover}
.sb-hero .desktop-media{display:block}
.sb-hero .mobile-media{display:none}

/* ========================================
   PHOTO LEDE SIDE - DESKTOP
   ======================================== */
.pls-desktop{display:flex;gap:0}
.pls-mobile{display:none}
.pls-image{height:100vh;flex-shrink:0}
.pls-media{width:100%;height:100%;object-fit:cover}
.pls-text{height:100vh;display:flex;align-items:center;justify-content:center}

/* ========================================
   PHOTO LEDE - DESKTOP
   ======================================== */
.photo-lede-photo{margin:0 auto 3rem auto;border-radius:0.5rem;overflow:hidden}
.photo-lede-photo[data-desktop-width="max-w-2xl"]{max-width:42rem}
.photo-lede-photo[data-desktop-width="max-w-4xl"]{max-width:56rem}
.photo-lede-photo[data-desktop-width="max-w-6xl"]{max-width:72rem}
.photo-lede-photo[data-desktop-width="w-full"]{max-width:100%}
.photo-lede-photo img{border-radius:0.5rem}
.photo-lede-caption{margin-top:1rem;text-align:center}
.photo-lede-text{margin:0 auto}
.photo-lede-text[data-desktop-width="max-w-md"]{max-width:28rem}
.photo-lede-text[data-desktop-width="max-w-lg"]{max-width:32rem}
.photo-lede-text[data-desktop-width="max-w-4xl"]{max-width:56rem}
.photo-lede-text[data-desktop-width="max-w-6xl"]{max-width:72rem}

/* ========================================
   SPLIT PANEL - DESKTOP
   ======================================== */
@media (min-width: 1025px) {
  .split-panel-wrapper{width:100%;position:relative}
  .split-panel-container{position:relative;min-height:200vh}
  .split-panel-row{position:absolute !important;width:100%;min-height:100vh;display:block !important;flex-direction:row !important}
  .split-panel-row:first-child{top:0}
  .split-panel-row:last-child{top:100vh}
  .split-panel-row::after{content:"";display:table;clear:both}
  .split-image-sticky{position:fixed !important;top:0;width:50% !important;height:100vh !important;z-index:1;opacity:0;clip-path:inset(100% 0 0 0);transition:clip-path 0s linear,opacity 0.3s ease;will-change:clip-path;transform:translateZ(0);backface-visibility:hidden}
  
  .split-panel-row:first-child .split-image-sticky{left:0 !important;right:auto !important}
  .split-panel-row:last-child .split-image-sticky{right:0 !important;left:auto !important}
  
  .split-panel-reversed .split-panel-row:first-child .split-image-sticky{left:auto !important;right:0 !important}
  .split-panel-reversed .split-panel-row:last-child .split-image-sticky{right:auto !important;left:0 !important}
  
  .split-image-content{width:100%;height:100%}
  .split-image-content img,.split-image-content video{width:100%;height:100%;object-fit:cover;display:block}
  .split-text-scroll{width:50% !important;min-height:100vh !important;float:left !important;display:flex !important;align-items:center;justify-content:center;padding:3rem;box-sizing:border-box;position:relative !important;z-index:2;-webkit-font-smoothing:antialiased}
  
  .split-panel-row:first-child .split-text-scroll{float:right !important}
  .split-panel-row:last-child .split-text-scroll{float:left !important}
  
  .split-panel-reversed .split-panel-row:first-child .split-text-scroll{float:left !important}
  .split-panel-reversed .split-panel-row:last-child .split-text-scroll{float:right !important}
  
  .split-text-inner{width:100%;max-width:800px}
  .split-panel-wrapper ~ *{position:relative;z-index:3;background:inherit}
}

/* Desktop/Mobile visibility toggles */
.split-desktop-only { display: block; }
.split-mobile-only { display: none; }

/* ========================================
   SPLIT PANEL - MOBILE STRUCTURE
   ======================================== */
.split-mobile-wrapper {
  position: relative;
  width: 100%;
}

.split-mobile-images {
  display: none;
}

.split-mobile-image {
  position: relative;
  width: 100%;
  height: 75vh;
  min-height: 350px;
  max-height: 550px;
  overflow: hidden;
}

.split-mobile-media {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.split-mobile-text {
  position: relative;
  z-index: 2;
}

.split-mobile-text-section {
  padding: 1.5rem;
  min-height: auto;
}

.split-mobile-panel {
  display: block;
}

.split-mobile-panel-image {
  width: 100%;
  height: 75vh;
  min-height: 350px;
  max-height: 550px;
  overflow: hidden;
}

.split-mobile-panel-image img,
.split-mobile-panel-image video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.split-mobile-panel-text {
  padding: 1.5rem;
}

.split-mobile-text-inner {
  width: 100%;
  margin: 0 auto;
}

/* ========================================
   ZOOM PHOTO - DESKTOP
   ======================================== */
.sb-zoomsec{position:relative;height:250vh;overflow:visible}
.sb-zoom-pin{position:sticky;top:0;height:100vh;width:100%;overflow:hidden}
.sb-zoom-photo{position:absolute;top:50%;left:50%;min-width:100%;min-height:100%;width:auto;height:auto;transform:translate(-50%,-50%);object-fit:cover;will-change:transform;transition:none}
.sb-zoom-vignette{position:absolute;inset:0;pointer-events:none;box-shadow:inset 0 0 150px 60px rgba(0,0,0,0.5);opacity:0;transition:opacity 0.3s ease}
.sb-zoom-panel{position:absolute;bottom:40px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.85);color:#fff;padding:1rem 1.5rem;border-radius:8px;max-width:400px;text-align:center;opacity:0;transition:opacity 0.3s ease}
.sb-zoom-spacer{position:relative;z-index:1}

/* ========================================
   PAIR FADE EFFECT
   ======================================== */
.sb-fadepair{position:relative;height:var(--fadeH,200vh)}
.sb-fade-prev{position:relative;height:100vh}
.sb-fade-next{position:sticky;top:0;height:100vh;opacity:var(--fadeOpacity,0);transition:opacity 0.1s linear;will-change:opacity}
.sb-fade-prev>*{min-height:100vh}.sb-fade-next>*{min-height:100vh}

[data-fade-scroll="true"]{
  transition:opacity .6s ease-out;
}


/* ========================================
   MOBILE STYLES (max-width: 1024px)
   ======================================== */

@media (max-width: 1024px) {

  .desktop-mute-btn { display: none !important; }
  .mobile-mute-btn { display: flex !important; }
  
  .sb-hero .mobile-mute-btn {
    bottom: 160px !important;
    left: 1.5rem !important;
  }
  
  .pls-mobile-image .mobile-mute-btn,
  .split-mobile-panel-image .mobile-mute-btn {
    bottom: 20px !important;
    left: 20px !important;
  }
  
  .gallery-mute-btn {
    display: flex !important;
    bottom: 20px !important;
    left: 20px !important;
  }
  
  .gallery-media-cell {
    position: relative !important;
  }

  .split-desktop-only { display: none !important; }
  .split-mobile-only { display: block !important; }
  
  .sb-hero.has-mobile-media .desktop-media{display:none}
  .sb-hero.has-mobile-media .mobile-media{display:block}

  .sb-hero {
    height: 200vh !important;
    min-height: 200vh !important;
    max-height: none !important;
    display: block !important;
    position: relative !important;
    clip: rect(0, auto, auto, 0) !important;
    clip-path: inset(0) !important;
  }
  
  .sb-hero .hero-image-section {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: 100vh !important;
    overflow: hidden !important;
    z-index: 1 !important;
  }
  
  .sb-hero .hero-image-section .media,
  .sb-hero .hero-image-section .media-picture,
  .sb-hero .hero-image-section video.media,
  .sb-hero .hero-image-section img.media {
    position: absolute !important;
    inset: 0 !important;
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    display: block !important;
  }
  
  .sb-hero .hero-image-section .media-picture img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
  }
  
  .sb-hero .hero-gradient {
    display: block !important;
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: 60% !important;
    background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.6) 40%, transparent 100%) !important;
    z-index: 5 !important;
    pointer-events: none !important;
  }
  
  .sb-hero .desktop-overlay {
    display: none !important;
  }
  
  .sb-hero .mobile-overlay {
    display: flex !important;
    position: absolute !important;
    inset: 0 !important;
    z-index: 10 !important;
    padding: 0 !important;
    padding-bottom: 100px !important;
    flex-direction: column !important;
    justify-content: flex-end !important;
    align-items: flex-start !important;
  }
  
  .hero-mobile-headline-container {
    padding: 1.5rem !important;
    max-width: 90% !important;
  }
  
  .hero-mobile-headline {
    font-size: clamp(2.5rem, 10vw, 3.5rem) !important;
    line-height: 1.05 !important;
    margin: 0 !important;
    text-shadow: 0 2px 12px rgba(0,0,0,0.8) !important;
    text-align: left !important;
  }
  
  .sb-hero .sb-hero-desktop-deck {
    display: none !important;
  }
  
  .hero-mobile-deck-section {
    display: block !important;
    position: absolute !important;
    top: 100vh !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 20 !important;
    height: 100vh !important;
    background: #000 !important;
    box-sizing: border-box !important;
  }
  
  .hero-mobile-deck-text {
    position: relative !important;
    top: 50vh !important;
    transform: translateY(-50%) !important;
    padding: 0 3rem !important;
    font-size: 1.375rem !important;
    line-height: 1.6 !important;
    text-align: center !important;
    text-shadow: none !important;
  }

  .split-mobile-text-inner.max-w-md { max-width: 100%; }
  .split-mobile-text-inner.max-w-lg { max-width: 100%; }
  .split-mobile-text-inner.max-w-4xl { max-width: 100%; }
  .split-mobile-text-inner.max-w-6xl { max-width: 100%; }
  
  .split-mobile-text-section h2 {
    font-size: clamp(1.5rem, 6vw, 2rem) !important;
    margin-bottom: 0.75rem !important;
  }
  
  .split-mobile-text-section h3 {
    font-size: clamp(1.25rem, 4vw, 1.5rem) !important;
  }
  
  .split-mobile-text-section p {
    font-size: 1.0625rem !important;
    line-height: 1.65 !important;
  }
  
  [class*="split-panel-drop-cap"]::first-letter {
    font-size: 3rem !important;
    line-height: 2.5rem !important;
    padding-right: 8px !important;
  }
  
  [class*="split-panel-drop-cap"]::first-line {
    font-size: 1.25rem !important;
  }
  
  .split-mobile-panel-image {
    position: relative !important;
  }
  
  .split-mobile-subhead-overlay {
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%) !important;
    padding: 3rem 1.5rem 0.75rem 1.5rem !important;
    pointer-events: none !important;
  }
  
  .split-mobile-subhead-text {
    font-size: 1.125rem !important;
    text-shadow: 0 1px 4px rgba(0,0,0,0.8) !important;
    text-align: left !important;
  }
  
  .split-mobile-byline-overlay {
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%) !important;
    padding: 3rem 1.5rem 0.75rem 1.5rem !important;
    pointer-events: none !important;
  }
  
  .split-mobile-byline-text {
    font-size: 0.875rem !important;
    text-shadow: 0 1px 4px rgba(0,0,0,0.8) !important;
    text-align: left !important;
  }

  .pls-desktop {
    display: none !important;
  }
  
  .pls-mobile {
    display: block !important;
  }
  
  .pls-mobile-image {
    position: relative !important;
    width: 100% !important;
    height: 75vh !important;
    min-height: 350px !important;
    max-height: 550px !important;
    overflow: hidden !important;
  }
  
  .pls-mobile-image .pls-media,
  .pls-mobile-image img,
  .pls-mobile-image video {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
  }
  
  .pls-mobile-subhead-overlay {
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%) !important;
    padding: 3rem 1.5rem 0.75rem 1.5rem !important;
    pointer-events: none !important;
  }
  
  .pls-mobile-subhead-text {
    font-size: 1.125rem !important;
    text-shadow: 0 1px 4px rgba(0,0,0,0.8) !important;
    text-align: left !important;
  }
  
  .pls-mobile-byline-overlay {
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%) !important;
    padding: 3rem 1.5rem 0.75rem 1.5rem !important;
    pointer-events: none !important;
  }
  
  .pls-mobile-byline-text {
    font-size: 1rem !important;
    text-shadow: 0 1px 4px rgba(0,0,0,0.8) !important;
    text-align: left !important;
  }
  
  .pls-mobile-text {
    padding: 1.5rem !important;
  }
  
  .pls-mobile-text .max-w-md,
  .pls-mobile-text .max-w-lg,
  .pls-mobile-text .max-w-4xl,
  .pls-mobile-text .max-w-6xl {
    max-width: 100% !important;
  }
  
  .photo-lede-side-drop-cap::first-letter {
    font-size: 3rem !important;
    line-height: 2.5rem !important;
    padding-right: 8px !important;
  }
  
  .photo-lede-side-drop-cap::first-line {
    font-size: 1.25rem !important;
  }

  .photo-lede-section {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  
  .photo-lede-section.px-6 {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  
  .photo-lede-photo {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 0 !important;
  }
  
  .photo-lede-photo img,
  .photo-lede-photo video {
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important;
    border-radius: 0 !important;
    display: block !important;
  }
  
  .photo-lede-caption {
    padding: 0.5rem 1.5rem !important;
    text-align: left !important;
  }
  
  .photo-lede-text {
    padding: 0 1.5rem !important;
  }
  
  .photo-lede-drop-cap::first-letter {
    font-size: 3rem !important;
    line-height: 2.5rem !important;
    padding-right: 8px !important;
  }
  
  .photo-lede-drop-cap::first-line {
    font-size: 1.25rem !important;
  }

  .fullbleed {
    margin-left: 0 !important;
    margin-right: 0 !important;
    width: 100% !important;
  }
  
  .fullbleed img,
  .fullbleed video {
    width: 100% !important;
    height: auto !important;
    border-radius: 0 !important;
  }
  
  .fullbleed .rounded {
    border-radius: 0 !important;
  }

  .sb-zoomsec {
    height: auto !important;
    min-height: auto !important;
  }
  
  .sb-zoom-spacer {
    height: 2rem !important;
  }
  
  .sb-zoom-pin {
    position: relative !important;
    height: auto !important;
  }
  
  .sb-zoom-photo {
    position: relative !important;
    top: auto !important;
    left: auto !important;
    transform: none !important;
    width: 100% !important;
    height: auto !important;
    min-width: auto !important;
    min-height: auto !important;
  }
  
  .sb-zoom-vignette {
    display: none !important;
  }
  
  .sb-zoom-panel {
    position: relative !important;
    bottom: auto !important;
    left: auto !important;
    transform: none !important;
    opacity: 1 !important;
    margin: 1rem;
    max-width: 100% !important;
    text-align: left !important;
  }

  [style*="display:grid"][style*="grid-template-columns"] {
    display: flex !important;
    flex-direction: column !important;
    gap: 0.5rem !important;
  }
  
  [style*="display:grid"] > div {
    width: 100% !important;
    height: auto !important;
    min-height: 250px !important;
    max-height: 70vh !important;
    grid-column: auto !important;
    grid-row: auto !important;
  }
  
  [style*="display:grid"] > div img,
  [style*="display:grid"] > div video {
    width: 100% !important;
    height: 100% !important;
    min-height: 250px !important;
    object-fit: cover !important;
  }

  h1 {
    font-size: clamp(1.75rem, 6vw, 2.5rem) !important;
    line-height: 1.15 !important;
  }
  
  h2 {
    font-size: clamp(1.5rem, 5vw, 2rem) !important;
    line-height: 1.2 !important;
  }
  
  h3 {
    font-size: clamp(1.25rem, 4vw, 1.5rem) !important;
    line-height: 1.25 !important;
  }
  
  p, .leading-relaxed {
    font-size: 1.0625rem !important;
    line-height: 1.65 !important;
  }

  .px-6 {
    padding-left: 1.5rem !important;
    padding-right: 1.5rem !important;
  }
  
  .p-12 {
    padding: 1.5rem !important;
  }
  
  .pt-16, .pt-24 {
    padding-top: 1.5rem !important;
  }
  
  .pb-16, .pb-24 {
    padding-bottom: 1.5rem !important;
  }
  
  .pt-4 { padding-top: 1rem !important; }
  .pb-4 { padding-bottom: 1rem !important; }
  .pt-8 { padding-top: 1.25rem !important; }
  .pb-8 { padding-bottom: 1.25rem !important; }

  .max-w-md, .max-w-lg, .max-w-4xl, .max-w-6xl {
    max-width: 100% !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  [style*="border-left:4px"] {
    padding: 1.25rem 1.5rem !important;
    margin: 1.5rem 0 !important;
  }
  
  [style*="border-left:4px"] p {
    font-size: 1.125rem !important;
    line-height: 1.6 !important;
  }

  button, a[role="button"] {
    min-width: 44px !important;
    min-height: 44px !important;
  }

  body, html {
    overflow-x: hidden !important;
  }
  
  img, video {
    max-width: 100% !important;
  }
  
  .breakout-large {
    width: 100% !important;
    max-width: 100% !important;
    left: auto !important;
    transform: none !important;
  }
}

/* ========================================
   TABLET OVERRIDES (769px - 1024px)
   Larger text, margins, and image heights for tablets
   ======================================== */
@media (min-width: 769px) and (max-width: 1024px) {
  
  /* Hero headline larger for tablets */
  .hero-mobile-headline {
    font-size: clamp(3.5rem, 9vw, 5rem) !important;
  }
  
  /* Hero deck text larger */
  .hero-mobile-deck-text {
    font-size: 1.625rem !important;
    line-height: 1.7 !important;
    padding: 0 6rem !important;
  }
  
  /* PhotoLedeSide mobile text container - flex center */
  .pls-mobile-text {
    display: flex !important;
    justify-content: center !important;
    padding: 2rem 1.5rem !important;
  }
  
  /* PhotoLedeSide inner div - constrain width */
  .pls-mobile-text > .max-w-md,
  .pls-mobile-text > .max-w-lg,
  .pls-mobile-text > .max-w-4xl,
  .pls-mobile-text > .max-w-6xl {
    max-width: 720px !important;
    width: 100% !important;
  }
  
  /* PhotoLedeSide byline overlay - match text width */
  .pls-mobile-byline-overlay {
    display: flex !important;
    justify-content: center !important;
    padding-left: 1.5rem !important;
    padding-right: 1.5rem !important;
  }
  
  .pls-mobile-byline-overlay .pls-mobile-byline-text {
    max-width: 720px !important;
    width: 100% !important;
  }
  
  /* Split panel mobile text container - the actual class used */
  .split-mobile-panel-text {
    display: flex !important;
    justify-content: center !important;
    padding-left: 1.5rem !important;
    padding-right: 1.5rem !important;
  }
  
  /* Split panel inner content */
  .split-mobile-panel-text > .split-mobile-text-inner {
    max-width: 720px !important;
    width: 100% !important;
  }
  
  .split-mobile-text-inner.max-w-md,
  .split-mobile-text-inner.max-w-lg,
  .split-mobile-text-inner.max-w-4xl,
  .split-mobile-text-inner.max-w-6xl {
    max-width: 720px !important;
  }
  
  /* PhotoLede text - add top padding for spacing from image */
  .photo-lede-text {
    padding: 1.5rem !important;
    max-width: 720px !important;
    margin-left: auto !important;
    margin-right: auto !important;
  }
  
  .photo-lede-caption {
    padding: 0.75rem 1.5rem !important;
    max-width: 720px !important;
    margin-left: auto !important;
    margin-right: auto !important;
  }
  
  /* Body text larger */
  p, .leading-relaxed {
    font-size: 1.25rem !important;
    line-height: 1.75 !important;
  }
  
  /* Subhead/headline text larger */
  h2 {
    font-size: clamp(1.875rem, 5vw, 2.5rem) !important;
  }
  
  h3 {
    font-size: clamp(1.5rem, 4vw, 2rem) !important;
    margin-top: 1.5rem !important;
  }
  
  /* Byline text */
  .pls-mobile-byline-text,
  .split-mobile-byline-text {
    font-size: 1.125rem !important;
  }
  
  /* Image/video heights for tablets - allow portrait content to be tall */
  .pls-mobile-image {
    height: 85vh !important;
    min-height: 600px !important;
    max-height: none !important;
  }
  
  .split-mobile-panel-image {
    height: 85vh !important;
    min-height: 600px !important;
    max-height: none !important;
  }
  
  /* Subhead overlay text */
  .pls-mobile-subhead-text,
  .split-mobile-subhead-text {
    font-size: 1.375rem !important;
  }
  
  /* Split panel text content */
  .split-mobile-panel-text p,
  .split-mobile-text-inner p {
    font-size: 1.25rem !important;
    line-height: 1.75 !important;
  }
  
  .split-mobile-panel-text h2,
  .split-mobile-text-inner h2 {
    font-size: clamp(1.875rem, 5vw, 2.5rem) !important;
  }
  
  .split-mobile-panel-text h3,
  .split-mobile-text-inner h3 {
    font-size: clamp(1.5rem, 4vw, 2rem) !important;
  }
  
  /* Gallery items taller */
  [style*="display:grid"] > div {
    min-height: 450px !important;
    max-height: none !important;
  }
  
  [style*="display:grid"] > div img,
  [style*="display:grid"] > div video {
    min-height: 450px !important;
  }
  
  /* Photo lede - full width image, constrained text */
  .photo-lede-section {
    padding: 0 !important;
  }
  
  /* Drop cap slightly larger */
  .photo-lede-drop-cap::first-letter,
  .photo-lede-side-drop-cap::first-letter,
  [class*="split-panel-drop-cap"]::first-letter {
    font-size: 4rem !important;
    line-height: 3rem !important;
  }
}

@supports (-webkit-touch-callout: none) {
  @media (max-width: 1024px) {
    .sb-hero .hero-image-section {
      height: 100vh !important;
      height: -webkit-fill-available !important;
    }
    
    .hero-mobile-deck-section {
      height: 100vh !important;
      height: -webkit-fill-available !important;
      min-height: 100vh !important;
      min-height: -webkit-fill-available !important;
      max-height: 100vh !important;
      max-height: -webkit-fill-available !important;
    }
    
    .split-mobile-images {
      height: 80vh !important;
      height: -webkit-fill-available !important;
      max-height: 800px !important;
    }
  }
}

/* ========================================
   ORIENTATION LOCK FOR PHONES
   Lock to portrait on small screens (phones)
   ======================================== */
@media screen and (max-width: 600px) and (orientation: landscape) {
  html {
    transform: rotate(-90deg);
    transform-origin: left top;
    width: 100vh;
    height: 100vw;
    overflow-x: hidden;
    position: absolute;
    top: 100%;
    left: 0;
  }
}
</style>
  </head>
  <body>
    <div id="progress-bar" style="position:fixed;top:0;left:0;height:3px;background:#fbbf24;width:0%;z-index:9999;transition:width 0.1s;"></div>
    <div data-sb-block="0" data-sb-type="split-layout" data-sb-expected="4" data-sb-expected-std="4"><section class="sb-split-layout fullbleed overflow-hidden flex" style="position:relative;z-index:3;height:100vh;padding-top:0;padding-bottom:0;"><div style="position:absolute;top:0;left:50%;transform:translateX(-50%);width:100vw;height:100%;background:#000;z-index:0;"></div><div style="position:relative;z-index:1;display:flex;width:100%;height:100%;"><div class="flex flex-col justify-center items-center p-12" style="width:40%;background-color:#000000;"><div style="transform:translate(0px,0px);"><h1 style="color:#ffffff;font-size:70px;font-family:Merriweather, serif;font-weight:400;font-style:normal;line-height:1.2;text-shadow:0 2px 8px rgba(0,0,0,0.55);">Hiking<br/>Half Dome<br/>With My Kids</h1></div></div><div class="relative" style="width:60%;height:100vh;"><img class="media" src="media/009.jpeg" alt=""></div></div></section></div>
<div data-sb-block="1" data-sb-type="text" data-sb-expected="28" data-sb-expected-std="28"><style>.text-block-drop-cap-txt-33lwdd::first-letter{float:left;font-size:86px !important;line-height:73px !important;padding-right:10px;margin-top:2px;color:#121212 !important;font-weight:bold;}.text-block-drop-cap-txt-33lwdd::first-line{font-size:30px !important;font-weight:600 !important;color:#111827 !important;}.text-block-section a {
  color: #0052a3;
  text-decoration: underline;
  text-decoration-thickness: 1px;
  text-underline-offset: 2px;
  cursor: pointer;
  transition: text-decoration-thickness 0.15s ease, opacity 0.15s ease;
}
.text-block-section a:hover {
  text-decoration-thickness: 2px;
  opacity: 0.85;
}</style><section class="text-block-section relative pt-16 pb-2" data-fade-scroll="true" style="position:relative;z-index:3;background-color:#d0cdcd;"><div style="position:absolute;top:0;left:50%;transform:translateX(-50%);width:100vw;height:100%;background-color:#d0cdcd;z-index:0;"></div><div class="relative z-10 px-8 max-w-4xl mx-auto" style="position:relative;z-index:1;"><div style="margin-bottom:24px;"><div style="color:#374151;font-size:20px;font-family:system-ui;font-weight:400;font-style:normal;line-height:1.6;">By Marcus Chan</div><div style="font-size:16px;font-weight:400;color:#6b7280;margin-top:4px;">Yosemite, Calif. <span style="color:#6b7280;opacity:0.6;padding:0 8px;">|</span> August 8, 2025 <span style="color:#6b7280;opacity:0.6;padding:0 8px;">|</span> 2 min read</div></div><p class="text-block-drop-cap-txt-33lwdd" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">Sometimes as a parent, you have to go the extra mile to get quality time with your kids. Make that 16 extra miles. That's the round-trip distance of hiking from Yosemite's Happy Isles to the top of the iconic Half Dome. I had done this famously scenic and strenuous hike twice before and had no plans for a third. But my daughter and son really, really wanted to do it. And what better way to bond than to experience the exhilaration and exhaustion of doing The Dome together? So off we went.</p></div></section></div>
<div data-sb-block="2" data-sb-type="photo-lede-side" data-sb-expected="4" data-sb-expected-std="4"><style>.photo-lede-side-drop-cap-pls-143qhicu3::first-letter{float:left;font-size:80px !important;line-height:68px !important;padding-right:10px;margin-top:2px;color:#070603 !important;font-weight:bold;}.photo-lede-side-drop-cap-pls-143qhicu3::first-line{font-size:28px !important;font-weight:700 !important;color:#3c3939 !important;}.pls-section a {
  color: #0052a3;
  text-decoration: underline;
  text-decoration-thickness: 1px;
  text-underline-offset: 2px;
  cursor: pointer;
  transition: text-decoration-thickness 0.15s ease, opacity 0.15s ease;
}
.pls-section a:hover {
  text-decoration-thickness: 2px;
  opacity: 0.85;
}</style><section class="pls-section pt-16 pb-0" style="position:relative;z-index:3;background-color:#d0cdcd;" data-fade-scroll="true"><div style="position:absolute;top:0;left:50%;transform:translateX(-50%);width:100vw;height:100%;background-color:#d0cdcd;z-index:0;"></div><div style="position:relative;z-index:1;"><div class="pls-desktop"><div class="pls-image" style="width:50%;"><img src="media/001.jpeg" class="pls-media" alt=""></div><div class="pls-text" style="width:50%;padding-left:40px;padding-right:0;"><div class="max-w-lg mx-auto"><p class="photo-lede-side-drop-cap-pls-143qhicu3" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">This was all very last minute, to the point that we didn't have a place to stay the night before the permit date.</p><p style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">So we did the unadvisable -- we left San Francisco at 7 p.m. the day before our permit date, arrived in Yosemite at midnight, and found our way to the Curry Village parking lot. </p><p style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">Sleeping in your car overnight isn't allowed, so I’ll say we "rested" for an hour and a half. That’s clearly not enough rest for a hike like this, but that’s what we had to work with. </p><p style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">We got up at 2:45 a.m., in the dead of night, and geared up. (Photo by Griffin)</p></div></div></div><div class="pls-mobile"><div class="pls-mobile-image"><img src="media/001.jpeg" class="pls-media" alt=""></div><div class="pls-mobile-text"><div class="max-w-lg"><p class="photo-lede-side-drop-cap-pls-143qhicu3" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">This was all very last minute, to the point that we didn't have a place to stay the night before the permit date.</p><p style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">So we did the unadvisable -- we left San Francisco at 7 p.m. the day before our permit date, arrived in Yosemite at midnight, and found our way to the Curry Village parking lot. </p><p style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">Sleeping in your car overnight isn't allowed, so I’ll say we "rested" for an hour and a half. That’s clearly not enough rest for a hike like this, but that’s what we had to work with. </p><p style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">We got up at 2:45 a.m., in the dead of night, and geared up. (Photo by Griffin)</p></div></div></div></div></section></div>
<div data-sb-block="3" data-sb-type="photo-lede-side" data-sb-expected="4" data-sb-expected-std="4"><style>.photo-lede-side-drop-cap-pls-17d8t8bvh::first-letter{float:left;font-size:80px !important;line-height:68px !important;padding-right:10px;margin-top:2px;color:#070603 !important;font-weight:bold;}.photo-lede-side-drop-cap-pls-17d8t8bvh::first-line{font-size:28px !important;font-weight:700 !important;color:#3c3939 !important;}.pls-section a {
  color: #0052a3;
  text-decoration: underline;
  text-decoration-thickness: 1px;
  text-underline-offset: 2px;
  cursor: pointer;
  transition: text-decoration-thickness 0.15s ease, opacity 0.15s ease;
}
.pls-section a:hover {
  text-decoration-thickness: 2px;
  opacity: 0.85;
}</style><section class="pls-section pt-0 pb-16" style="position:relative;z-index:3;background-color:#d0cdcd;" data-fade-scroll="true"><div style="position:absolute;top:0;left:50%;transform:translateX(-50%);width:100vw;height:100%;background-color:#d0cdcd;z-index:0;"></div><div style="position:relative;z-index:1;"><div class="pls-desktop"><div class="pls-text" style="width:40%;padding-left:0;padding-right:40px;"><div class="max-w-lg mx-auto"><p class="photo-lede-side-drop-cap-pls-17d8t8bvh" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">We cycled to Happy Isles, where we parked our bikes, then made our way to the Mist Trail. It was 4 a.m., and the top of Half Dome was a "mere" 8.2 miles away.</p></div></div><div class="pls-image" style="width:60%;"><img src="media/002.jpeg" class="pls-media" alt=""></div></div><div class="pls-mobile"><div class="pls-mobile-image"><img src="media/002.jpeg" class="pls-media" alt=""></div><div class="pls-mobile-text"><div class="max-w-lg"><p class="photo-lede-side-drop-cap-pls-17d8t8bvh" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;margin-bottom:20px;">We cycled to Happy Isles, where we parked our bikes, then made our way to the Mist Trail. It was 4 a.m., and the top of Half Dome was a "mere" 8.2 miles away.</p></div></div></div></div></section></div>
<div data-sb-block="4" data-sb-type="split-panel" data-sb-expected="4" data-sb-expected-std="4"><div class="split-panel-wrapper split-desktop-only" id="split-panel-8x8glgaml" style="background-color:#000000;"><div class="split-panel-container" style="background-color:#000000;"><section class="split-panel-row" style="background-color:#000000;"><div class="split-image-sticky"><div class="split-image-content"><img src="" alt=""></div></div><div class="split-text-scroll pt-16 pb-16" style="background-color:#000000;"><div class="split-text-inner max-w-4xl"><div class="leading-relaxed" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;"></div></div></div></section><section class="split-panel-row" style="background-color:#000000;"><div class="split-text-scroll pt-16 pb-16" style="background-color:#000000;"><div class="split-text-inner max-w-4xl"><div class="leading-relaxed" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;"></div></div></div><div class="split-image-sticky"><div class="split-image-content"><img src="" alt=""></div></div></section></div></div><div class="split-mobile-wrapper split-mobile-only" id="split-panel-8x8glgaml-mobile" style="background-color:#000000;"><div class="split-mobile-panel" data-panel="0"><div class="split-mobile-panel-image"><img class="split-mobile-media" src="" alt=""></div><div class="split-mobile-panel-text pt-16 pb-16" style="background-color:#000000;"><div class="split-mobile-text-inner max-w-4xl"><div class="leading-relaxed" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;"></div></div></div></div><div class="split-mobile-panel" data-panel="1"><div class="split-mobile-panel-image"><img class="split-mobile-media" src="" alt=""></div><div class="split-mobile-panel-text pt-16 pb-16" style="background-color:#000000;"><div class="split-mobile-text-inner max-w-4xl"><div class="leading-relaxed" style="color:#3c3939;font-size:22px;font-family:Newsreader, serif;font-weight:400;font-style:normal;line-height:1.7;"></div></div></div></div></div></div>
    <script>
(function(){
  var els = document.querySelectorAll('[data-fade-scroll="true"]');
  if(!els.length) return;
  
  var ticking = false;
  var scrollCount = 0;
  
  function checkVisibility(){
    if(ticking) return;
    ticking = true;
    
    requestAnimationFrame(function(){
      var vh = window.innerHeight;
      
      for(var i = 0; i < els.length; i++){
        var el = els[i];
        if(el.style.opacity === '1') continue;
        
        var rect = el.getBoundingClientRect();
        if(rect.top < vh * 0.85){
          el.style.opacity = '1';
        }
      }
      
      ticking = false;
    });
  }
  
  function onScroll(){
    if(scrollCount === 1){
      setTimeout(checkVisibility, 50);
    } else {
      checkVisibility();
    }
    scrollCount++;
  }
  
  setTimeout(function(){
    var vh = window.innerHeight;
    for(var i = 0; i < els.length; i++){
      var el = els[i];
      var rect = el.getBoundingClientRect();
      if(rect.top > vh * 0.5){
        el.style.opacity = '0';
      }
    }
  }, 100);
  
  window.addEventListener('scroll', onScroll, {passive: true});
})();</script>
    
    <script>
function toggleMute(videoId, button) {
  var video = document.getElementById(videoId);
  if (!video) return;
  video.muted = !video.muted;
  var mutedLine = button.querySelector('.muted-line');
  var unmutedPath = button.querySelector('.unmuted-path');
  if (video.muted) {
    if (mutedLine) mutedLine.style.display = 'block';
    if (unmutedPath) unmutedPath.style.opacity = '0.3';
  } else {
    if (mutedLine) mutedLine.style.display = 'none';
    if (unmutedPath) unmutedPath.style.opacity = '1';
  }
}
(function(){
  var wrappers=document.querySelectorAll('.split-panel-wrapper');
  if(!wrappers.length)return;
  
  wrappers.forEach(function(wrapper){
    var container=wrapper.querySelector('.split-panel-container');
    if(!container)return;
    
    var rows=container.querySelectorAll('.split-panel-row');
    if(rows.length<2)return;
    
    var firstRow=rows[0];
    var secondRow=rows[1];
    
    var firstImage=firstRow.querySelector('.split-image-sticky');
    var secondImage=secondRow.querySelector('.split-image-sticky');
    if(!firstImage||!secondImage)return;
    
    function applyMobileStyles(){
      firstImage.style.display='block';
      firstImage.style.clipPath='none';
      firstImage.style.opacity='1';
      firstImage.style.position='relative';
      firstImage.style.transform='none';
      
      secondImage.style.display='block';
      secondImage.style.clipPath='none';
      secondImage.style.opacity='1';
      secondImage.style.position='relative';
      secondImage.style.transform='none';
      
      firstRow.style.opacity='1';
      firstRow.style.visibility='visible';
      secondRow.style.opacity='1';
      secondRow.style.visibility='visible';
    }
    
    function checkAndApply(){
      var isMobile = window.innerWidth <= 1024;

      if(isMobile){
        applyMobileStyles();
        return;
      }

      var windowHeight=window.innerHeight;
      var firstRowRect=firstRow.getBoundingClientRect();
      var secondRowRect=secondRow.getBoundingClientRect();

      // If split panel is below viewport, hide both images
      if(firstRowRect.top>=windowHeight){
        firstImage.style.display='none';
        secondImage.style.display='none';
        return;
      }
      
      if(firstRowRect.top<windowHeight&&firstRowRect.bottom>windowHeight*0.01){
        firstImage.style.display='block';
        var revealAmount=Math.max(0,Math.min(windowHeight,windowHeight-firstRowRect.top));
        var clipPercent=(revealAmount/windowHeight)*100;
        firstImage.style.clipPath='inset('+(100-clipPercent)+'% 0 0 0)';
        firstImage.style.opacity='1';
      } else {
        firstImage.style.display='none';
      }
      
      if(secondRowRect.top<windowHeight&&secondRowRect.bottom>windowHeight*0.01){
        secondImage.style.display='block';
        var revealAmount2=Math.max(0,Math.min(windowHeight,windowHeight-secondRowRect.top));
        var clipPercent2=(revealAmount2/windowHeight)*100;
        secondImage.style.clipPath='inset('+(100-clipPercent2)+'% 0 0 0)';
        secondImage.style.opacity='1';
      } else {
        secondImage.style.display='none';
      }
    }
    
    firstImage.style.transition='opacity 0.4s ease';
    secondImage.style.transition='opacity 0.4s ease';
    
    window.addEventListener('scroll',checkAndApply,{passive:true});
    window.addEventListener('resize',checkAndApply);
    window.addEventListener('load',checkAndApply);
    checkAndApply();
  });
})();</script><script>
(function(){
  function isMobile() {
    return window.innerWidth <= 1024;
  }
  
  function initMobileSplitPanels() {
    if (!isMobile()) return;
    
    var wrappers = document.querySelectorAll('.split-mobile-wrapper');
    if (!wrappers.length) return;
    
    wrappers.forEach(function(wrapper) {
      var imagesContainer = wrapper.querySelector('.split-mobile-images');
      var images = wrapper.querySelectorAll('.split-mobile-image');
      var textSections = wrapper.querySelectorAll('.split-mobile-text-section');
      
      if (!imagesContainer || !images.length || !textSections.length) return;
      
      var currentPanel = 0;
      var ticking = false;
      
      function updateActiveImage() {
        if (!isMobile()) return;
        
        var imagesRect = imagesContainer.getBoundingClientRect();
        var triggerPoint = imagesRect.bottom;
        
        var activePanel = 0;
        
        for (var i = 0; i < textSections.length; i++) {
          var section = textSections[i];
          var rect = section.getBoundingClientRect();
          
          if (rect.top <= triggerPoint) {
            activePanel = i;
          }
        }
        
        if (activePanel !== currentPanel) {
          currentPanel = activePanel;
          
          for (var j = 0; j < images.length; j++) {
            images[j].style.opacity = (j === activePanel) ? '1' : '0';
          }
        }
      }
      
      function onScroll() {
        if (!ticking) {
          requestAnimationFrame(function() {
            updateActiveImage();
            ticking = false;
          });
          ticking = true;
        }
      }
      
      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('resize', updateActiveImage);
      
      setTimeout(updateActiveImage, 100);
    });
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileSplitPanels);
  } else {
    initMobileSplitPanels();
  }
})();</script>
    <script>
(function(){
  var videos = document.querySelectorAll('video');
  if (!videos.length) return;
  
  // Firefox autoplay fix - force play on muted autoplay videos
  videos.forEach(function(v) {
    if (v.hasAttribute('autoplay') && v.muted) {
      v.play().catch(function(e) {
        // Autoplay was prevented, try again on user interaction
        document.addEventListener('click', function playOnce() {
          v.play();
          document.removeEventListener('click', playOnce);
        }, { once: true });
      });
    }
  });
  
  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (!entry.isIntersecting) {
        var video = entry.target;
        video.muted = true;
        // Update any associated mute button
        var container = video.closest('.hero-image-section, .pls-mobile-image, .pls-image, .split-mobile-panel-image, .split-image-content, .gallery-media-cell');
        if (container) {
          var btn = container.querySelector('.mute-btn');
          if (btn) {
            var mutedLine = btn.querySelector('.muted-line');
            var unmutedPath = btn.querySelector('.unmuted-path');
            if (mutedLine) mutedLine.style.display = 'block';
            if (unmutedPath) unmutedPath.style.opacity = '0.3';
          }
        }
      }
    });
  }, { threshold: 0.1 });
  
  videos.forEach(function(v) { observer.observe(v); });
})();</script>
    <script>
window.addEventListener('scroll', function() {
  var h = document.documentElement;
  var b = document.body;
  var st = 'scrollTop';
  var sh = 'scrollHeight';
  var percent = (h[st]||b[st]) / ((h[sh]||b[sh]) - h.clientHeight) * 100;
  document.getElementById('progress-bar').style.width = percent + '%';
}, {passive: true});
</script>
    
<script>
(function() {
  const SUPABASE_URL = 'https://bobrvqpasntigqcrerqa.supabase.co';
  const SUPABASE_ANON_KEY = 'sb_publishable_buetBM4cFeIFRRFbOURKcA_9Ewwoa8J';
  const STORY_ID = '77ed37fb-a2a7-4aee-903c-d2a46eb20847';
  const SESSION_ID = 'ses_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
  const blockTimes = new Map();
  let maxScrollDepth = 0;

  async function sendEvent(eventType, data = {}) {
    try {
      await fetch(SUPABASE_URL + '/rest/v1/analytics_events', {
        method: 'POST',
        credentials: 'omit',
        headers: {
          'Content-Type': 'application/json',
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': 'Bearer ' + SUPABASE_ANON_KEY,
          'Prefer': 'return=minimal'
        },
        body: JSON.stringify({
          story_id: STORY_ID,
          session_id: SESSION_ID,
          event_type: eventType,
          block_index: data.blockIndex ?? null,
          block_type: data.blockType ?? null,
          event_data: data.eventData ?? {},
          user_agent: navigator.userAgent,
          viewport_width: window.innerWidth,
          viewport_height: window.innerHeight,
          referrer: document.referrer || null
        })
      });
    } catch (e) { console.warn('[Analytics]', e); }
  }

  sendEvent('page_view');

  const blocks = document.querySelectorAll('[data-sb-block]');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const block = entry.target;
      const index = parseInt(block.dataset.sbBlock);
      const type = block.dataset.sbType || 'unknown';
      if (!blockTimes.has(index)) {
        blockTimes.set(index, { startTime: null, totalTime: 0, visible: false, tracked: false });
      }
      const state = blockTimes.get(index);
      if (entry.isIntersecting) {
        state.visible = true;
        state.startTime = Date.now();
        if (!state.tracked) {
          state.tracked = true;
          sendEvent('block_view', { blockIndex: index, blockType: type });
        }
      } else {
        if (state.visible && state.startTime) {
          state.totalTime += Date.now() - state.startTime;
        }
        state.visible = false;
        state.startTime = null;
      }
    });
  }, { threshold: 0.5 });
  blocks.forEach(block => observer.observe(block));

  let scrollTimeout;
  window.addEventListener('scroll', () => {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      const scrollPct = Math.round((window.scrollY + window.innerHeight) / document.documentElement.scrollHeight * 100);
      if (scrollPct > maxScrollDepth) maxScrollDepth = scrollPct;
    }, 100);
  }, { passive: true });

  function sendEngagement() {
    blockTimes.forEach((st, index) => {
      if (st.visible && st.startTime) st.totalTime += Date.now() - st.startTime;
    });
    const blockElements = document.querySelectorAll('[data-sb-block]');
    blockTimes.forEach((st, index) => {
      if (st.totalTime > 1000) {
        const block = blockElements[index];
        const expectedTime = parseInt(block?.dataset.sbExpected) || 0;
        const expectedTimeStd = parseInt(block?.dataset.sbExpectedStd) || 0;
        const engagementPct = expectedTime > 0 ? Math.round((st.totalTime / 1000 / expectedTime) * 100) : 0;
        const engagementPctStd = expectedTimeStd > 0 ? Math.round((st.totalTime / 1000 / expectedTimeStd) * 100) : 0;
        fetch(SUPABASE_URL + '/rest/v1/analytics_events', {
          method: 'POST', keepalive: true, credentials: 'omit',
          headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_ANON_KEY, 'Authorization': 'Bearer ' + SUPABASE_ANON_KEY, 'Prefer': 'return=minimal' },
          body: JSON.stringify({
            story_id: STORY_ID, session_id: SESSION_ID, event_type: 'block_engage',
            block_index: index, block_type: block?.dataset.sbType || 'unknown',
            event_data: {
              duration_ms: st.totalTime,
              expected_time_sec: expectedTime,
              expected_time_std_sec: expectedTimeStd,
              engagement_pct: engagementPct,
              engagement_pct_std: engagementPctStd
            },
            user_agent: navigator.userAgent, viewport_width: window.innerWidth,
            viewport_height: window.innerHeight, referrer: document.referrer || null
          })
        });
      }
    });
    if (maxScrollDepth > 0) {
      fetch(SUPABASE_URL + '/rest/v1/analytics_events', {
        method: 'POST', keepalive: true, credentials: 'omit',
        headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_ANON_KEY, 'Authorization': 'Bearer ' + SUPABASE_ANON_KEY, 'Prefer': 'return=minimal' },
        body: JSON.stringify({
          story_id: STORY_ID, session_id: SESSION_ID, event_type: 'scroll_depth',
          block_index: null, block_type: null, event_data: { scroll_pct: maxScrollDepth },
          user_agent: navigator.userAgent, viewport_width: window.innerWidth,
          viewport_height: window.innerHeight, referrer: document.referrer || null
        })
      });
    }
  }
  window.addEventListener('beforeunload', sendEngagement);
  document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'hidden') sendEngagement(); });
})();
</script>
  </body>
</html>